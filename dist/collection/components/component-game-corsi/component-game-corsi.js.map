{"version":3,"file":"component-game-corsi.js","sourceRoot":"","sources":["../../../../src/components/component-game-corsi/component-game-corsi.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, Method, Prop, h } from '@stencil/core';\r\nimport { User } from '../../models/user';\r\nimport { Log } from '../../models/log';\r\nimport * as PIXI from \"pixi.js\"\r\nimport { Map } from \"./map\"\r\nimport config from \"./config.json\"\r\nimport { ScoreCalculator } from '../../scoreCalculator';\r\nimport { CorsiLog } from '../../models/game-models/corsi-log';\r\n\r\n@Component({\r\n  tag: 'component-game-corsi',\r\n  styleUrl: 'component-game-corsi.css',\r\n  shadow: false,\r\n})\r\nexport class ComponentGameCorsi {\r\n\r\n  @Prop() player_id: number;\r\n  @Prop() education? : string;\r\n  @Prop() sex? : number;\r\n  @Prop() birthYear? : number;\r\n  @Prop() region: number;\r\n  @Prop() customLang?: (\"hu\" | \"en\");\r\n  @Prop() difficulty?: number = 0;\r\n  @Prop() rows?: number = 7;\r\n  @Prop() cols?: number = 4;\r\n\r\n\r\n  @Event() finish: any;\r\n\r\n  user: User;\r\n  container: any;\r\n  app!: PIXI.Application;\r\n  loader= new PIXI.Loader;\r\n  pauseDate: number;\r\n  log: Log;\r\n  specificLog: CorsiLog;\r\n  dim: any;\r\n  map: any;\r\n  started = false;\r\n\r\n  constructor(){\r\n    this.user = new User(this.region, this.player_id, this.sex, this.education, this.birthYear)\r\n\r\n  }\r\n\r\n  start(){\r\n\r\n    if(!this.started){\r\n      this.container = document.getElementById('game') as HTMLElement;\r\n      this.dim = {\r\n        w: this.container.offsetWidth,\r\n        h: this.container.offsetHeight\r\n      }\r\n      \r\n\r\n      this.app = new PIXI.Application({\r\n        width:  this.dim.w, \r\n        height: this.dim.h, \r\n        antialias: true, \r\n        resolution: 1,\r\n        backgroundColor: 0xffffff,\r\n      });\r\n\r\n      this.container.appendChild(this.app.view);\r\n\r\n    }\r\n    else {\r\n      this.app.stage.removeChild(this.map);\r\n      this.map = null;\r\n    }\r\n    \r\n\r\n      this.log = new Log(\r\n        this.user,                    //user data (player_id, region, sex, education, birthYear)          \r\n        \"corsi\",                    //game_name\r\n        new Date().toISOString(),     //start_time\r\n        \"mobile\",                     //mobile\r\n        \"4.0\",                        //game_version\r\n        \"unknown\",                    //ui_agent\r\n        this.dim.w,                   //ui_width\r\n        this.dim.h);                  //ui_height\r\n\r\n        \r\n        this.specificLog = new CorsiLog;\r\n        this.map = new Map(this.getSettings(), this);\r\n        this.app.stage.addChild(this.map);\r\n        this.started = true;\r\n\r\n  }\r\n\r\n  public getSettings() {\r\n    return  { animLength: 3 + 2 * this.difficulty };\r\n  }\r\n\r\n  @Method() async pause() {\r\n    this.pauseDate = Date.now()\r\n    this.log.pause_count++;\r\n    console.log('paused')\r\n  }\r\n\r\n  @Method() async resume(){\r\n      this.log.pause_time += Date.now()-this.pauseDate\r\n      console.log('resumed')\r\n  }\r\n\r\n  @Method() async stop(){\r\n      this.log.interrupt();\r\n      this.sendLog();\r\n      console.log('stopped');\r\n  }\r\n\r\n  @Method() async restart(){\r\n    this.stop();\r\n    this.start();\r\n  }\r\n\r\n  sendLog(){\r\n    let duration = Date.now()-new Date(this.log.start_time).getTime();\r\n    this.log.duration = duration;\r\n    this.log.game_specific_data = JSON.stringify(this.specificLog);\r\n    this.log.send();\r\n  }\r\n\r\n  fillLoader(){\r\n    this.loader.add(\"bg\", 'assets/res/img/bg.jpg')\r\n      .add(\"1\", 'assets/res/img/1.png')\r\n      .add(\"2\", 'assets/res/img/2.png')\r\n      .add(\"3\", 'assets/res/img/3.png')\r\n      .add(\"4\", 'assets/res/img/4.png')\r\n      .add(\"5\", 'assets/res/img/5.png')\r\n      .load( () => this.start()\r\n      )\r\n  }\r\n  calculateScore(){\r\n      const diff = this.difficulty || 0;\r\n\t\t\tconst goodValues = [];\r\n\t\t\tconst values = [];\r\n\t\t\tconst acceptableValues = [];\r\n\t\t\tconst weights = [];\r\n\t\t\t//number of steps\r\n\t\t\tgoodValues.push(config[diff].nofBadAnswers.good);\r\n\t\t\tvalues.push(this.specificLog.nofBadAnswers);\r\n\t\t\tacceptableValues.push(config[diff].nofBadAnswers.acceptable);\r\n\t\t\tweights.push(config[diff].nofBadAnswers.weight);\r\n\t\t\t//playTime\r\n\t\t\tgoodValues.push(config[diff].playTime.good);\r\n      let duration = new Date().getTime() - new Date(this.log.start_time).getTime() - this.log.pause_time\r\n\t\t\tvalues.push(duration / 1000);\r\n\t\t\tacceptableValues.push(config[diff].playTime.acceptable);\r\n\t\t\tweights.push(config[diff].playTime.weight);\r\n\r\n\t\t\tconst calculator = new ScoreCalculator(2, diff);\r\n\t\t\tlet real =calculator.getRealScore(goodValues,values,acceptableValues,weights);\r\n      this.log.score = real;\r\n      this.sendLog();\r\n      this.finish.emit({score: real, duration: duration})\r\n\r\n\r\n\t\t};\r\n  \r\n\r\n  componentDidRender(){\r\n    setTimeout(()=> {\r\n      this.fillLoader()\r\n    }, 20)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div id=\"game\" class=\"game-content\">\r\n      </div>\r\n    );\r\n  }\r\n\r\n}\r\n"]}